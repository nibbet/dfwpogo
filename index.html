<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <link rel="manifest" href="manifest.json" />
  <link rel="stylesheet" href="dfwstyle.css">
  <link rel="apple-touch-icon" href="/img/apple-touch-icon.png" />
  <meta name="theme-color" content="#cc0000" />
  <!-- Open Graph Meta Tags for Discord Embed -->
<meta property="og:title" content="DFW Area Pokémon GO Community" />
<meta property="og:description" content="Join epic meetups and catch ‘em all across DFW!" />
<meta property="og:image" content="https://dfwpogo.com/img/social-preview.png" />
<meta property="og:url" content="https://dfwpogo.com" />
<meta property="og:type" content="website" /> 

<!-- Optional: Twitter Card Tags (Discord sometimes uses them too) -->
<meta name="twitter:card" content="summary_large_image" />
<meta name="twitter:title" content="DFW Area Pokémon GO Community" />
<meta name="twitter:description" content="Check in and join the fun across DFW!" />
<meta name="twitter:image" content="https://dfwpogo.com/img/social-preview.png" />

  <title>DFW Area Pokémon GO</title>
  
</head>


<body>
  <header id="main-header">
    <h1>DFW Area Pokémon GO</h1>
  </header>

  <main>
    <div class="tabs" role="tablist" aria-label="Main Tabs">
      <button class="tab-button active" onclick="showTab('info', event)" role="tab" aria-selected="true">Current Event Info</button>
      <button class="tab-button" onclick="showTab('communities', event)" role="tab" aria-selected="false">Communities</button>
    </div>
    <div id="swipe-area">
      <!--event info-->
      <div id="info" class="tab-content active">
          <div id="event-container"></div>
        </div>
        <div id="communities" class="tab-content">
        <ul id="community-list"></ul>
      </div>
    </div>
  </main>

  <div style="text-align:center; margin-top: 1em;">
   <center><a href="https://discord.gg/YTNmVde6Vg" target="_blank" class="link-button-blue" >
      <img src="img/discord.png" alt="Discord" class="button-icon">Join Our Discord</a></center>
  </div>

  <footer>
    Created for DFW Trainers
  </footer>

  <script src="js/communities.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <script>
      const eventFiles = ['meetup-info.md'];
      const eventContainer = document.getElementById('event-container');

      eventFiles.forEach(file => {
        fetch(file)
          .then(response => response.text())
          .then(md => {
            const lines = md.split('\n');

            // Handle optional top-level title
            if (lines[0].startsWith('# ')) {
              const titleElem = document.createElement('h2');
              titleElem.textContent = lines[0].replace(/^#\s*/, '').trim();
              eventContainer.appendChild(titleElem);
              lines.shift();
            }

            let intro = [];
            let currentTitle = '';
            let currentContent = [];
            const sections = [];

            lines.forEach(line => {
              if (line.startsWith('## ')) {
                if (currentTitle) {
                  sections.push({
                    title: currentTitle,
                    content: currentContent.join('\n')
                  });
                } else if (intro.length) {
                  // no-op, intro already captured
                }
                currentTitle = line.replace(/^##\s*/, '').trim();
                currentContent = [];
              } else {
                if (!currentTitle) {
                  intro.push(line);
                } else {
                  currentContent.push(line);
                }
              }
            });

            if (currentTitle) {
              sections.push({
                title: currentTitle,
                content: currentContent.join('\n')
              });
            }

            if (intro.length) {
              const introDiv = document.createElement('div');
              introDiv.innerHTML = marked.parse(intro.join('\n'));
              eventContainer.appendChild(introDiv);
            }

            sections.forEach(sec => {
              const details = document.createElement('details');
              const summary = document.createElement('summary');
              summary.textContent = sec.title;
              details.appendChild(summary);
              const contentDiv = document.createElement('div');
              contentDiv.innerHTML = marked.parse(sec.content);
              details.appendChild(contentDiv);
              eventContainer.appendChild(details);
            });
          })
          .catch(err => {
            const errorDiv = document.createElement('div');
            errorDiv.textContent = 'Failed to load meetup info.';
            eventContainer.appendChild(errorDiv);
            console.error('Failed to load meetup markdown:', err);
          });
      });

    const tabIds = ['info', 'communities'];
    let currentTab = 0;

    function showTab(tabId, event) {
      const tabs = document.querySelectorAll('.tab-content');
      const buttons = document.querySelectorAll('.tab-button');
      tabs.forEach(tab => tab.classList.remove('active'));
      buttons.forEach((btn, idx) => {
        btn.classList.remove('active');
        btn.setAttribute('aria-selected', 'false');
        if (tabIds[idx] === tabId) {
          btn.classList.add('active');
          btn.setAttribute('aria-selected', 'true');
        }
      });
      document.getElementById(tabId).classList.add('active');
      currentTab = tabIds.indexOf(tabId);
    }

    // Scoped swipe detection
    const swipeArea = document.getElementById('swipe-area');
    let touchStartX = 0;
    let touchEndX = 0;

    swipeArea.addEventListener('touchstart', function(e) {
      touchStartX = e.changedTouches[0].screenX;
    });

    swipeArea.addEventListener('touchend', function(e) {
      touchEndX = e.changedTouches[0].screenX;
      const delta = touchEndX - touchStartX;

      if (Math.abs(delta) > 50) {
        if (delta < 0 && currentTab < tabIds.length - 1) {
          showTab(tabIds[currentTab + 1]); // Swipe Left
        } else if (delta > 0 && currentTab > 0) {
          showTab(tabIds[currentTab - 1]); // Swipe Right
        }
      }
    });

    // Pull-to-refresh implementation
let startY = 0;
let isPulling = false;
let refreshElem = null;

function createRefreshElem() {
  if (!refreshElem) {
    refreshElem = document.createElement('div');
    refreshElem.style.position = 'fixed';
    refreshElem.style.top = '0';
    refreshElem.style.left = '0';
    refreshElem.style.right = '0';
    refreshElem.style.height = '40px';
    refreshElem.style.background = '#cc0000';
    refreshElem.style.color = '#fff';
    refreshElem.style.display = 'flex';
    refreshElem.style.alignItems = 'center';
    refreshElem.style.justifyContent = 'center';
    refreshElem.style.fontWeight = 'bold';
    refreshElem.style.zIndex = '9999';
    refreshElem.style.transform = 'translateY(-40px)';
    refreshElem.style.transition = 'transform 0.2s';
    refreshElem.innerText = '↻ Refreshing...';
    document.body.appendChild(refreshElem);
  }
}

window.addEventListener('touchstart', function(e) {
  if (window.scrollY === 0) {
    startY = e.touches[0].clientY;
    isPulling = true;
  }
});

window.addEventListener('touchmove', function(e) {
  if (!isPulling) return;
  const currentY = e.touches[0].clientY;
  if (currentY - startY > 60) {
    createRefreshElem();
    refreshElem.style.transform = 'translateY(0)';
  }
});

window.addEventListener('touchend', function(e) {
  if (refreshElem && refreshElem.style.transform === 'translateY(0px)') {
    setTimeout(() => {
      location.reload();
    }, 400);
  }
  if (refreshElem) {
    refreshElem.style.transform = 'translateY(-40px)';
  }
  isPulling = false;
});

    // Dynamic header content based on device
    function updateHeaderForDevice() {
      const header = document.getElementById('main-header');
      if (!header) return;
      if (window.innerWidth <= 600) {
        // Mobile
        header.innerHTML = `
          <h1 style="font-size:1.3em;">DFW Area Pokémon GO</h1>
     
          
        `;
      } else {
        // Desktop/tablet
        header.innerHTML = `
          <h1>DFW Area Pokémon</h1>
          <p>Join us for epic Pokémon GO adventures in the Dallas-Fort Worth area!</p>
        `;
      }
    }

    window.addEventListener('DOMContentLoaded', updateHeaderForDevice);
    window.addEventListener('resize', updateHeaderForDevice);

    // Register service worker
    if ('serviceWorker' in navigator) {
      navigator.serviceWorker.register('./service-worker.js')
        .then(reg => console.log('Service Worker registered!', reg))
        .catch(err => console.log('Service Worker registration failed:', err));
    }
  </script>
</body>
</html>
